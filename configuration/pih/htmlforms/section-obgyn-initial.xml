<htmlform id="section-obgyn-initial"
          formUuid="fd19a3d0-4aa4-415c-a25a-dc1159098796"
          formName="OB-GYN initial section"
          formVersion="1.0">

    <style type="text/css">

        form fieldset {
            min-width: 90%
        }

        #encounterDate input {
            min-width: 15%
        }

        textarea {
            overflow-y: hidden; /* fixes scrollbar flash - kudos to @brettjonesdev */
            padding-top: 1.1em; /* fixes text jump on Enter keypress */
        }

        @media print {
            .print-form-datestamps { display: block !important }
            button.cancel, button.submit { display: none }
            label { font-weight: bold }
            label[for] { font-weight: normal } /* refers to the radio set label */
        }

        .side-by-side label {
            display: inline-block;
        }

        .family-history-item .label {
            display: inline-block;
            width: 250px;
        }
        .family-history-item .relative {
            display: inline-block;
            width: 120px;
        }

        .past-medical-history-item input[type=checkbox] {
            float: none;
            vertical-align: middle;
        }

        .past-medical-history-item input[type=text] {
            min-width: 200px;
            display: inline !important;
            vertical-align: middle;
            padding: 1px 10px;
        }

        .past-medical-history-item > span, .past-medical-history-item > label {
            display: inline !important;
            vertical-align: middle;
        }

        .two-columns {
            column-count: 2;
            -webkit-column-count: 2;
            -moz-column-count: 2;
        }

        .three-columns {
            column-count: 3;
            -webkit-column-count: 3;
            -moz-column-count: 3;
        }

        .four-columns {
            column-count: 4;
            -webkit-column-count: 4;
            -moz-column-count: 4;
        }
        .section-container {
            background: #F2F2F2;
            box-shadow: 3px 3px 3px 1px rgba(0, 0, 0, 0.2);
            padding: 10px 5px 10px 15px;
            line-height: 1.5em; /*add this for vertical spacing between elements*/
        }

        .section-container input[type="checkbox"] {
            margin: 0px 5px; /*changed values to vertical, horizontal*/
            top:5px; /*added to offset the checkbox position to line up*/
        }

        .section-container label { /*new definition to override labels inside section-containers*/
            margin: 0px;
        }

        - .section {
            width: 100%;
        }

        .section-header {
            margin-top: 1.5em;
        }

        form input[type="radio"], .form input[type="radio"] {
            float: none;
            display: inline-block;
        }

        #vitals fieldset p {
            vertical-align: top;
            display: inline-block;
            float: none;
        }

        #vitals fieldset .left {
            vertical-align: top;
            display: inline-block;
            float: none;
        }

    </style>

    <style type="text/css">
        <ifMode mode="VIEW" include="true">

            #section-delivery legend {
            display: none;
            }

            #section-delivery fieldset {
            margin: 0px;
            border: 0px;
            padding: 0px;
            }

            #section-delivery fieldset h3 {
            font-size: 1em;
            width: 200px;
            display: inline-block;
            margin: 0px;
            margin-right: 10px;
            color: #501d3d;
            vertical-align: top;
            }

            #section-delivery fieldset p {
            vertical-align: top;
            display: inline-block;
            float: none;
            }

            #section-delivery fieldset .left {
            vertical-align: top;
            display: inline-block;
            float: none;
            }

            #section-delivery .title {
                display: none;
            }

            #section-delivery .encounter-date {
                display: none;
            }

            #section-delivery .encounter-provider {
                display: none;
            }

            #section-delivery .encounter-location {
                display: none;
            }

            #section-delivery .comment-label {
                display: none;
            }

            #section-delivery .comment-field {
                display: block;
                margin-left: 215px;
            }

            #section-delivery br {
                display: none;
            }
        </ifMode>
    </style>

    <ifMode mode="VIEW" include="false">

        <script type="text/javascript">
            jq(document).ready(function() {

            // get timestamp of obs.valueDateTime
            var lastLMP = '<lookup expression="fn.latestObs('CIEL:1427').getValueDatetime().getTime()"/>';
            // console.log("lastLMP: " + lastLMP);
            var currentEncounterDate = '<lookup expression="encounter.getEncounterDatetime().getTime()"/>';
            if (typeof lastLMP !== "undefined" &amp;&amp; lastLMP !== null &amp;&amp; (lastLMP.length > 0)) {

                var lastLMPDate = new Date(+lastLMP);

                if ( (Object.prototype.toString.call(lastLMPDate) === "[object Date]") &amp;&amp; !isNaN(lastLMPDate.getTime())) {
                    var today = new Date();
                    if (typeof currentEncounterDate !== "undefined" &amp;&amp; currentEncounterDate !== null &amp;&amp; (currentEncounterDate.length > 0)) {
                        // calculate the gestational age at the time of the encounter
                        today = new Date(+currentEncounterDate);
                    }

                    var years = today.getFullYear() - lastLMPDate.getFullYear();  // Start with difference in calendar year
                    var months = today.getMonth() - lastLMPDate.getMonth(); // Add or subtract the months apart
                    var dayDiff = today.getDate() - lastLMPDate.getDate(); // Subtract a month if the day of the month is earlier
                    var monthsBetween = years*12 + months - (dayDiff >= 0 ? 0 : 1);

                    if (monthsBetween >= 1 &amp;&amp;  monthsBetween &lt;= 9) {
                        // patient is pregnant

                        // time difference
                        var timeDiff = Math.abs(today.getTime() - lastLMPDate.getTime());
                        // weeks difference = gestational age
                        var diffWeeks = Math.ceil(timeDiff / (1000 * 3600 * 24 * 7));

                        var estimatedDeliveryDate = new Date(+lastLMP);
                        // Estimated Delivery Date = (LMP - 3 months) + 12 months + 7 days
                        estimatedDeliveryDate.setMonth(estimatedDeliveryDate.getMonth() - 3);
                        estimatedDeliveryDate.setFullYear(estimatedDeliveryDate.getFullYear() + 1);
                        estimatedDeliveryDate.setDate(estimatedDeliveryDate.getDate() + 7);

                        var widgetDate = getField('lastPeriodDate.value').datepicker('setDate', estimatedDeliveryDate).val();
                        getField('lastPeriodDate.value').datepicker('setDate', null);

                        jq('#calculated-edd-and-gestational').show();
                        jq('#calculated-edd').text(widgetDate);
                        jq('#calculated-gestational-age-value').text(diffWeeks + " " + '<uimessage code="pihcore.weeks"/>');
                    }

              }
            } else {
              jq('#calculated-edd-and-gestational').hide();
            }

                // handle our custom functionality for triggering going to the next section when the "Next" button is clicked
                jq('#next').click(function() {
                    window.htmlForm.getBeforeSubmit().push(function () {
                        window.htmlForm.setReturnUrl(window.htmlForm.getReturnUrl() + "&amp;goToNextSection=section-obgyn-initial");
                        return true;
                    });

                    window.htmlForm.submitHtmlForm();
                });

                jq('#submit').click(function() {
                    window.htmlForm.submitHtmlForm();
                })

            });
        </script>
    </ifMode>

    <!-- special formatting when in view mode -->
    <style type="text/css">
        <ifMode mode="VIEW" include="false">
            #family-history br {
                display: none;
            }
        </ifMode>
    </style>

    <ifMode mode="VIEW" include="false">
        <script type="text/javascript">
            jq(function() {

            var validateFamHistoryText = function(divElem) {
            var parentDiv = divElem.closest('.medicalHistoryText');

            if (typeof parentDiv !== "undefined" ) {
            var fieldError = parentDiv.find('.field-error');
            var commentsInput= parentDiv.find('input[type=text]');
            if (typeof commentsInput !== "undefined" ) {
            var comments = commentsInput.val();
            if ((typeof comments !=="undefined") &amp;&amp; comments.length > 0 ) {
            if ( parentDiv.find('input:checked').length &lt; 1 ) {
            if (parentDiv.hasClass("famHistory")) {
            fieldError.html("<uimessage code='pihcore.historyNote.family.indicateParent'/>").show();
            } else if (parentDiv.hasClass("patientHistory")) {
            fieldError.html("<uimessage code='pihcore.historyNote.pastMedicalHistory.checkWithoutComments'/>").show();
            }

            return false;
            }
            } else {
            // if there are no comments make sure the adjacent Parent checkbox is not checked
            if ( parentDiv.find('input:checked').length &gt; 0 ) {
            fieldError.html("<uimessage code='pihcore.historyNote.family.specifyComments'/>").show();
            return false;
            }
            }
            }
            fieldError.html(" ").hide();
            }
            return true;
            }


            jq('.medicalHistoryText').find('input[type=checkbox]').change(function() {
            validateFamHistoryText(jq(this));
            });

            jq('.medicalHistoryText').find('input[type=text]').change(function() {
            validateFamHistoryText(jq(this));
            });

            // handle our custom functionality for triggering going to the next section when the "Next" button is clicked
            jq('#next').click(function() {
            window.htmlForm.getBeforeSubmit().push(function () {
            window.htmlForm.setReturnUrl(window.htmlForm.getReturnUrl() + "&amp;goToNextSection=pihcore-history");
            return true;
            });

            window.htmlForm.submitHtmlForm();
            })

            jq('#submit').click(function() {
            window.htmlForm.submitHtmlForm();
            })


            beforeSubmit.push(function() {
            var numErrors = 0;
            jq('.medicalHistoryText').find('input[type=text]').each(function() {
            if (!validateFamHistoryText(jq(this)) ) {
            ++numErrors;
            }
            });
            return ( numErrors == 0 );
            });

            });
        </script>
    </ifMode>

    <section id="referralIn" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.refer.title">
        <div class="section-container">
            <div class="two-columns">
                <p>
                    <repeat>
                        <template>
                            <obs conceptId="PIH:Type of referring service"
                                 style="checkbox"
                                 answerConceptId="{point}" />
                            <!-- answerCode="{message}"/> -->
                        </template>

                        <render point="CIEL:1589" message="pihcore.x" comment="Hospital"/>
                        <render point="PIH:PRIMARY CARE CLINIC" message="pihcore.location.primary"
                                comment="Primary care"/>
                         <render point="CIEL:160473" message="pihcore.location.ed" comment="Emergency"/>
                    </repeat>

                    <obs conceptId="PIH:Type of referring service" style="checkbox"
                         answerConceptId="PIH:OTHER" commentFieldLabel=""/>
                </p>

                <p>
                    <strong>
                        <uimessage code="pihcore.refer.community"/>
                    </strong>

                    <obs conceptId="PIH:Type of referring service" style="checkbox"
                         answerConceptId="CIEL:1555"/>
                    <obs conceptId="PIH:Type of referring service" style="checkbox"
                         answerConceptId="PIH:11965"/>
                </p>

            </div>
        </div>
    </section>

    <section id="vitals" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="pihcore.vitalSigns">
        <div class="section-container">
            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.triageLevel"/>
                </label>

                <obs conceptId="PIH:Triage color classification" style="radio"
                     answerConceptIds="PIH:Triage red,PIH:Yellow,PIH:Triage green"
                     answerSeparator="" />
            </p>
        </div>
        <br/>

        <div class="section-container">
            <div class="two-columns">
                <p>
                    <label>
                        <uimessage code="mirebalais.vitals.short.heartRate.title"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5087" id="heart_rate"
                             showUnits="emr.units.perMinute" unitsCssClass="append-to-value"/>
                    </span>
                </p>

                <p>
                    <label>
                        <uimessage code="mirebalais.vitals.respiratoryRate.short.title"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5242" id="respiratory_rate"
                             showUnits="emr.units.perMinute" unitsCssClass="append-to-value"/>
                    </span>
                </p>

                <p>
                    <label>
                        <uimessage code="Temp"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5088" id="temperature_c"
                             showUnits="emr.units.degreesCelsius" unitsCssClass="append-to-value"/>
                    </span>
                </p>

                <fieldset field-separator=" / ">
                    <p class="left">
                        <uimessage code="mirebalais.vitals.bloodPressure.short.title"/>
                    </p>
                    <p class="left">
                        <obs conceptId="CIEL:5085" id="bp_systolic"/>
                    </p>
                    <p class="left">
                        /
                    </p>
                    <p class="left">
                        <obs conceptId="CIEL:5086" id="bp_diastolic"/>
                    </p>
                </fieldset>

                <!-- ToDo:  Add weight/height -->
                <p>
                    <label>
                        <uimessage code="mirebalais.vitals.o2sat.title"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5092" id="o2_sat"
                             showUnits="emr.units.percent" unitsCssClass="append-to-value"/>
                    </span>
                </p>

                <p>
                    <label>
                        <uimessage code="mirebalais.vitals.muac.navigation.title"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:1343" id="muac"
                             showUnits="cm" unitsCssClass="append-to-value"/>
                    </span>
                </p>

            </div>
        </div>
    </section>

    <section id="habits" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="pihcore.habits">
        <div class="section-container">
            <p class="side-by-side">
                <!-- Alcohol use -->
                <label>
                    <uimessage code="Alcohol"/>:
                </label>
                <obs conceptId="CIEL:159449" answerConceptIds="CIEL:159450,CIEL:159452,CIEL:1090"
                     style="radio"  />
                <br/>

                <!-- Tobacco -->
                <label position="left">
                    <uimessage code="pihcore.tobacco"/>:
                </label>
                <obs conceptId="CIEL:163731"
                     answerConceptIds="CIEL:159450,CIEL:159452,CIEL:1090"
                     style="radio"  />
                <br/>

                <!-- Drug use -->
                <label>
                    <uimessage code="pihcore.drugs"/>:
                </label>
                <obs conceptId="CIEL:162556" answerConceptIds="CIEL:159450,CIEL:159452,CIEL:1090"
                     style="radio" />
                <br/>

                <label>
                    <uimessage code="pihcore.habits.drugName"/>
                </label>
                <span class="small">
                    <obs conceptId="PIH:6489"/>
                </span>
            </p>
        </div>
    </section>

    <section id="patient-history" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="zl.consultNote.patientHistory.title">
        <div class="section-container">
            <!-- ANTECEDENTS PERSONNELS / HABITUDES -->

            <div class="two-columns">
                <pastMedicalHistoryCheckbox concept="CIEL:117703" name="sickle cell"/>
                <pastMedicalHistoryCheckbox concept="PIH:HEART DISEASE" specify="true" class="medicalHistoryText patientHistory" />
                <pastMedicalHistoryCheckbox concept="PIH:DIABETES"/>
                <pastMedicalHistoryCheckbox concept="PIH:ASTHMA"/>
                <pastMedicalHistoryCheckbox concept="PIH:HYPERTENSION" label="pihcore.medicalhistory.hypertension"/>
                <pastMedicalHistoryCheckbox concept="PIH:SEXUALLY TRANSMITTED INFECTION" label="pihcore.medicalhistory.sti"
                                            specify="true" class="medicalHistoryText patientHistory"/>
                <pastMedicalHistoryCheckbox concept="PIH:TUBERCULOSIS"/>
                <pastMedicalHistoryCheckbox concept="CIEL:138405" label="pihcore.lab.hiv.title"/>
            </div>

            <div class="two-columns">
                <pastMedicalHistoryCheckbox concept="CIEL:113859" />
                <pastMedicalHistoryCheckbox concept="PIH:47" />
                <pastMedicalHistoryCheckbox concept="PIH:Eclampsia" />

                <pastMedicalHistoryCheckbox concept="PIH:SURGERY" specify="true" class="medicalHistoryText patientHistory"/>
                <pastMedicalHistoryCheckbox concept="PIH:Traumatic Injury" specify="true" class="medicalHistoryText patientHistory"/>
                <pastMedicalHistoryCheckbox concept="PIH:OTHER" code="pihcore.other" specify="true" class="medicalHistoryText patientHistory"/>

            </div>
        </div>
    </section>

    <section id="family-history" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="zl.consultNote.familyHistory.title">
        <div class="section-container">
            <!-- ANTECEDENTS HEREDO-COLLATERAUX -->
            <familyHistoryRelativeCheckboxes concept="PIH:ASTHMA" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:HEART DISEASE" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:DIABETES" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:EPILEPSY" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="CIEL:117635" comment="HÃ©moglobinopathie"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:HYPERTENSION" label="pihcore.medicalhistory.hypertension"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:TUBERCULOSIS" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <br/>
            <familyHistoryRelativeCheckboxes id="familyCancer" class="medicalHistoryText famHistory"
                                             concept="CIEL:116031" label="Cancer"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"
                                             specify="true"/>

            <br/>
            <familyHistoryRelativeCheckboxes id="familyOther" class="medicalHistoryText famHistory"
                                             concept="PIH:OTHER" code="pihcore.other"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"
                                             specify="true"/>
        </div>
    </section>

    <section id="hiv" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="pihcore.lab.hiv.title">
        <div class="section-container">

            <label>
                <uimessage code="pihcore.dateEnrollHIV" />
            </label>

            <label>
                <uimessage code="pihcore.hivTestPast3mo" />
            </label>

            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.hiv.whoStages"/>:
                </label>
                <obs conceptId="CIEL:5356"
                     answerConceptIds="CIEL:1204,CIEL:1205,CIEL:1206,CIEL:1207,CIEL:1067"
                     answerCodes="1,2,3,4,pihcore.unknown"
                     answerSeparator="&amp;nbsp;" style="radio" />
            </p>

            <h4>
                <uimessage code="CD4"/>
            </h4>
            <div class="two-columns">
                <p class="radio">
                    <label>
                        <uimessage code="pihcore.lab.cd4Count"/>
                    </label>
                    <obs conceptId="CIEL:5497" /> <!-- count -->
                    <br/>

                    <label>
                        <uimessage code="pihcore.lab.cd4Percent"/>
                    </label>
                    <obs conceptId="CIEL:730"/> <!-- % -->
                </p>
            </div>

            <p class="side-by-side">
                <label>
                    <uimessage code="On ARV"/>
                </label>
                <obs conceptId="CIEL:160119" style="radio"
                     answerConceptIds="CIEL:1066,CIEL:1065"/>

            </p>

            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.hiv.startDateARV" />
                </label>
                <obs conceptId="CIEL:159599" />
            </p>
        </div>
    </section>

    <section id="family-plan-section" sectionTag="fieldset"
             headerTag="legend" headerStyle="title"
             headerCode="pihcore.familyPlanning.title">

        <div class="section-container">
            <div class="two-columns">
                <obs conceptId="CIEL:163560" style="checkbox"
                     answerConceptId="CIEL:1382" answerCode="pihcore.mch.counselling.familyPlanning" />
                <br/>
                <obs conceptId="CIEL:965" style="checkbox"
                     answerConceptId="CIEL:1065" answerCode="pihcore.currentlyUsing"/>
            </div>

            <strong>
                <uimessage code="pihcore.fpMethod" />
            </strong>
            <div class="three-columns">
                <repeat>
                    <template>
                        <p>
                            <obsgroup groupingConceptId="PIH:Family planning construct">
                                <obs conceptId="CIEL:374"
                                     answerConceptId="{fpMethod}"
                                     answerCode="{comment}"
                                     style="checkbox" />
                            </obsgroup>
                        </p>
                    </template>

                    <render fpMethod="CIEL:159783" comment="COC"/>
                    <render fpMethod="CIEL:80784"  comment="COP"/>
                    <render fpMethod="CIEL:907"    comment="Depo-provera"/>

                    <render fpMethod="CIEL:1873" comment="Implant"/>
                    <render fpMethod="CIEL:5275" comment="pihcore.fp.iud"/>
                    <render fpMethod="CIEL:5277" comment="pihcore.fp.rhythm" />

                    <render fpMethod="CIEL:136163" comment="pihcore.fp.breast" />
                    <render fpMethod="CIEL:190" comment="Condoms"/>
                    <render fpMethod="CIEL:1472" comment="pihcore.fp.tubalLig"/>
                </repeat>
            </div>

            <div class="two-columns">
                <label>
                    <uimessage code="pihcore.startDate"/>:
                </label>
                <obs conceptId="CIEL:163757" />

                <label>
                    <uimessage code="pihcore.endDate"/>:
                </label>
                <obs conceptId="CIEL:163758" />
            </div>

            <p>
                <label>
                    <uimessage code="pihcore.dateImplant"/>:
                </label>
                <obs conceptId="PIH:3203" />
            </p>
        </div>
    </section>

    <section id="obgyn-section" sectionTag="fieldset"
             headerTag="legend" headerStyle="title"
             headerCode="OB/GYN">
        <div class="section-container">

            <div class="two-columns">
                <!-- Last menstrual period (LMP or DDR) -->
                <p>
                    <label>
                        <uimessage code="pihcore.pregnancy.lastPeriod"/>
                    </label>
                    <span class="small">
                        <obs id="lastPeriodDate" conceptId="CIEL:1427" allowFutureDates="false"/>
                    </span>
                </p>

                <!-- Due date (DPA) -->
                <p>
                    <label>
                        <uimessage code="pihcore.pregnancy.dueDate"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5596" allowFutureDates="true"/>
                    </span>
                </p>
            </div>

            <div id="calculated-edd-and-gestational" class="two-columns hidden">
                <p>
                    <span id="calculated-gestational-age-wrapper">
                        <span id="calculated-gestational-age-label">
                            <uimessage code="pihcore.calculatedGestationalAge"/>:&#160;
                        </span>
                        <span id='calculated-gestational-age-value' class="value"></span>
                    </span>
                </p>
                <p>
                    <span id="calculated-edd-wrapper">
                        <span id="calculated-edd-label">
                            <uimessage code="pihcore.calculatedEstimatedDeliveryDate"/>:&#160;
                        </span>
                        <span id='calculated-edd' class="value"></span>
                    </span>
                </p>
            </div>

            <div class="two-columns">
                <p>
                    <label>
                        <uimessage code="pihcore.durationMenstCycle"/>
                    </label>
                    <obs conceptId="CIEL:160597" />
                    <br/>

                    <label>
                        <uimessage code="pihcore.durationMenses"/>
                    </label>
                    <obs conceptId="CIEL:163732" />
                </p>
            </div>

            <div class="four-columns">
                <p>
                    <label>
                        <uimessage code="pihcore.mch.grava"/>
                    </label>
                    <obs conceptId="CIEL:5624" required="true" id="gravidaInput"/>
                </p>
                <p>
                    <label>
                        <uimessage code="pihcore.mch.para"/>
                    </label>
                    <obs conceptId="CIEL:1053" required="true"/>
                </p>
                <p>
                    <label>
                        <uimessage code="pihcore.mch.abortus"/>
                    </label>
                    <obs conceptId="CIEL:1823" required="true"/>
                </p>
                <p>
                    <label>
                        <uimessage code="pihcore.mch.living"/>
                    </label>
                    <obs conceptId="CIEL:1825" required="true"/>
                </p>
            </div>

            <p class="side-by-side">
                <label>
                    <uimessage code="Menstruation" />
                </label>
                <obs conceptId="CIEL:166080" style="radio"
                     answerConceptIds="CIEL:1115,CIEL:116616,CIEL:127"
                     answerCodes="pihcore.regular,pihcore.irregular,pihcore.dysmenorrhea" />
            </p>

            <div class="three-columns">
                <label>
                    <uimessage code="pihcore.ageMenarche" />
                </label>
                <obs conceptId="CIEL:160598" />

                <label>
                    <uimessage code="pihcore.age1stSexualInter" />
                </label>
                <obs conceptId="CIEL:163587" />

                <label>
                    <uimessage code="pihcore.numSexPartners" />
                </label>
                <obs conceptId="CIEL:5570" />
            </div>

            <br/>
            <table>
                <tr>
                    <th>
                        <uimessage code="Birth order" />
                    </th>
                    <th>
                        <uimessage code="Type of delivery" />
                    </th>
                    <th>
                        <uimessage code="Outcome" />
                    </th>
                </tr>
                <repeat>
                    <template>
                        <obsgroup groupingConceptId="CIEL:163588">
                        <tr>
                            <td>
                                <obs conceptId="CIEL:163460" defaultValue="{count}"/>
                            </td>
                            <td>
                                <obs conceptId="PIH:11663" />
                            </td>
                            <td>
                                <obs conceptId="CIEL:161033" />
                            </td>
                        </tr>
                        </obsgroup>
                    </template>
                    <render count="1" />
                    <render count="2" />
                    <render count="3" />
                    <render count="4" />
                    <render count="5" />
                    <render count="6" />
                </repeat>
                <tr>

                </tr>
            </table>
        </div>
    </section>

    <section id="risk-factors" sectionTag="fieldset" headerTag="legend"
              headerStyle="title" headerCode="pihcore.mch.riskFactors">

        <div class="section-container">
            <div class="two-columns">
                <!-- Risk factors for mother -->
                <!-- Anemia -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:121629" style="checkbox"/>
                <!-- Hypertension -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:117399" style="checkbox"/>
                <!-- Edema -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:460" style="checkbox"/>
                <!-- Diabetes -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:119481" style="checkbox"/>
                <!-- C-section -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:163155"
                     answerCode="pihcore.mch.previousCSection" style="checkbox"/>
                <!-- HIV -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:138405"
                     answerCode="pihcore.lab.hiv.title" style="checkbox"/>
                <!-- Multiple gestation -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:115491" style="checkbox"/>

                <!-- Placental abruption -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:130108" style="checkbox"/>
                <!-- Placenta previa -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:114127" style="checkbox"/>
                <!-- Antepartum hemorrhage -->
                <obs conceptId="CIEL:160079" answerConceptId="PIH:ANTEPARTUM HEMORRHAGE" style="checkbox"/>
                <!-- Fetal death -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:140399" style="checkbox"/>
                <!-- Malpresentation of fetus -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:115939" style="checkbox"/>
                <!-- answerCodes="pihcore.mch.gbv" -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:165088"
                     style="checkbox"/>
                <!-- Syphilis -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:112493"
                     style="checkbox"/>

                <obs conceptId="CIEL:160079" answerConceptId="PIH:OTHER"
                     commentFieldLabel="  " style="checkbox"/>

                <!-- ToDo: Change to mapping PIH:11930 -->
                <!-- ToDo: Specify other high risk factor, but doesn't work with text that doesn't match
                <obs conceptId="CIEL:160079" answerConceptSetIds="1da49fd7-b1fe-4053-8309-061c37ea56be"
                     style="autocomplete" />
                     -->
            </div>
        </div>
    </section>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <button id="next" type="button" class="submitButton confirm right">
                <uimessage code="emr.next"/>
                <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
            </button>
            <button id="submit" class="submitButton confirm right">
                <uimessage code="mirebalais.save"/>
                <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
            </button>
            <button id="cancel" type="button" class="cancel">
                <uimessage code="emr.cancel"/>
            </button>
        </div>
    </ifMode>

</htmlform>
