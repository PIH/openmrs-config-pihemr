<htmlform id="section-obgyn-initial"
          formUuid="fd19a3d0-4aa4-415c-a25a-dc1159098796"
          formName="OB/GYN Overview"
          formVersion="1.0">
    <postSubmissionAction class="org.openmrs.module.pihcore.htmlformentry.action.CleanDiagnosisConstructAction"/>

    <translations defaultLocale="en">
        <code name="o2Sat">
            <variant locale="en" value="O&lt;sub&gt;2&lt;/sub&gt; Sat"/>
            <variant locale="fr" value="SpO&lt;sub&gt;2&lt;/sub&gt;"/>
            <variant locale="es" value="SatO&lt;sub&gt;2&lt;/sub&gt;"/>
        </code>
    </translations>

    <style type="text/css">

        form fieldset {
            min-width: 90%
        }

        #encounterDate input {
            min-width: 15%
        }

        textarea {
            overflow-y: hidden; /* fixes scrollbar flash - kudos to @brettjonesdev */
            padding-top: 1.1em; /* fixes text jump on Enter keypress */
        }

        @media print {
            .print-form-datestamps { display: block !important }
            button.cancel, button.submit { display: none }
            label { font-weight: bold }
            label[for] { font-weight: normal } /* refers to the radio set label */
        }

        .side-by-side label {
            display: inline-block;
        }

        .family-history-item .label {
            display: inline-block;
            width: 250px;
        }
        .family-history-item .relative {
            display: inline-block;
            width: 120px;
        }

        .past-medical-history-item input[type=checkbox] {
            float: none;
            vertical-align: middle;
        }

        .past-medical-history-item input[type=text] {
            min-width: 200px;
            display: inline !important;
            vertical-align: middle;
            padding: 1px 10px;
        }

        .past-medical-history-item > span, .past-medical-history-item > label {
            display: inline !important;
            vertical-align: middle;
        }

        .two-columns {
            column-count: 2;
            -webkit-column-count: 2;
            -moz-column-count: 2;
        }

        .three-columns {
            column-count: 3;
            -webkit-column-count: 3;
            -moz-column-count: 3;
        }

        .four-columns {
            column-count: 4;
            -webkit-column-count: 4;
            -moz-column-count: 4;
        }
        .section-container {
            background: #F2F2F2;
            box-shadow: 3px 3px 3px 1px rgba(0, 0, 0, 0.2);
            padding: 10px 5px 10px 15px;
            line-height: 1.5em; /*add this for vertical spacing between elements*/
        }

        .section-container input[type="checkbox"] {
            margin: 0px 5px; /*changed values to vertical, horizontal*/
            top:5px; /*added to offset the checkbox position to line up*/
        }

        .section-container label { /*new definition to override labels inside section-containers*/
            margin: 0px;
        }

        - .section {
            width: 100%;
        }

        .section-header {
            margin-top: 1.5em;
        }

        form input[type="radio"], .form input[type="radio"] {
            float: none;
            display: inline-block;
        }

        #vitals fieldset p {
            vertical-align: top;
            display: inline-block;
            float: none;
        }

        #vitals fieldset .left {
            vertical-align: top;
            display: inline-block;
            float: none;
        }

    </style>

    <ifMode mode="VIEW" include="false" >
        <script type="text/javascript">

            jq(function() {

            var updateEdd = function() {

            var lastPeriodDate = htmlForm.getValueIfLegal('lastPeriodDate.value');
            if (typeof lastPeriodDate !== "undefined" &amp;&amp; lastPeriodDate !== null &amp;&amp; (lastPeriodDate.length > 0)) {

            var today = new Date();
            var currentEncounterDate = '<lookup expression="encounter.getEncounterDatetime().getTime()"/>';
            if (typeof currentEncounterDate !== "undefined" &amp;&amp; currentEncounterDate !== null &amp;&amp; (currentEncounterDate.length > 0)) {
            // calculate the gestational age at the time of the encounter
            today = new Date(+currentEncounterDate);
            }

            var dateObj = getField('lastPeriodDate.value').datepicker('getDate');
            var newDate = new Date(dateObj);
            // time difference
            var timeDiff = Math.abs(today.getTime() - newDate.getTime());
            // weeks difference = gestational age
            var diffWeeks = Math.ceil(timeDiff / (1000 * 3600 * 24 * 7));

            // Estimated Delivery Date = (LMP - 3 months) + 12 months + 7 days
            newDate.setMonth(newDate.getMonth() - 3);
            newDate.setFullYear(newDate.getFullYear() + 1);
            newDate.setDate(newDate.getDate() + 7);

            var widgetDate = getField('lastPeriodDate.value').datepicker('setDate', newDate).val();
            getField('lastPeriodDate.value').datepicker('setDate', dateObj);

            jq('#calculated-edd-and-gestational').show();
            jq('#calculated-edd').text(widgetDate);
            jq('#calculated-gestational-age-value').text(diffWeeks + " " + '<uimessage code="pihcore.weeks"/>');

            } else {
            jq('#calculated-edd-and-gestational').hide();
            }
            };

            jq('#calculated-edd-and-gestational').hide();

            jq("#lastPeriodDate input[type='hidden']").change(function() {
            updateEdd();
            });

            updateEdd();
            });
        </script>
    </ifMode>

    <!-- special formatting when in view mode -->
    <style type="text/css">
        <ifMode mode="VIEW" include="false">
            #family-history br {
                display: none;
            }
        </ifMode>
    </style>

    <ifMode mode="VIEW" include="false">
        <script type="text/javascript">
            jq(function() {

                var validateFamHistoryText = function(divElem) {
                    var parentDiv = divElem.closest('.medicalHistoryText');

                    if (typeof parentDiv !== "undefined" ) {
                        var fieldError = parentDiv.find('.field-error');
                        var commentsInput= parentDiv.find('input[type=text]');
                        if (typeof commentsInput !== "undefined" ) {
                            var comments = commentsInput.val();
                            if ((typeof comments !=="undefined") &amp;&amp; comments.length > 0 ) {
                                if ( parentDiv.find('input:checked').length &lt; 1 ) {
                                    if (parentDiv.hasClass("famHistory")) {
                                        fieldError.html("<uimessage code='pihcore.historyNote.family.indicateParent'/>").show();
                                    } else if (parentDiv.hasClass("patientHistory")) {
                                        fieldError.html("<uimessage code='pihcore.historyNote.pastMedicalHistory.checkWithoutComments'/>").show();
                                    }

                                return false;
                                }
                            } else {
                                // if there are no comments make sure the adjacent Parent checkbox is not checked
                                if ( parentDiv.find('input:checked').length &gt; 0 ) {
                                    fieldError.html("<uimessage code='pihcore.historyNote.family.specifyComments'/>").show();
                                    return false;
                                }
                            }
                        }
                        fieldError.html(" ").hide();
                    }
                    return true;
                }

                jq('.medicalHistoryText').find('input[type=checkbox]').change(function() {
                    validateFamHistoryText(jq(this));
                });

                jq('.medicalHistoryText').find('input[type=text]').change(function() {
                    validateFamHistoryText(jq(this));
                });

                // handle our custom functionality for triggering going to the next section when the "Next" button is clicked
                jq('#next').click(function() {
                    window.htmlForm.getBeforeSubmit().push(function () {
                        window.htmlForm.setReturnUrl(window.htmlForm.getReturnUrl() + "&amp;goToNextSection=section-obgyn-initial");
                        return true;
                    });

                    window.htmlForm.submitHtmlForm();
                })

                jq('#submit').click(function() {
                    window.htmlForm.submitHtmlForm();
                })

                beforeSubmit.push(function() {
                    var numErrors = 0;
                    jq('.medicalHistoryText').find('input[type=text]').each(function() {
                        if (!validateFamHistoryText(jq(this)) ) {
                            ++numErrors;
                        }
                    });
                    return ( numErrors == 0 );
                });

            });
        </script>
    </ifMode>

    <!-- Program enrollment -->
    <enrollInProgram programId="MCH" locationTag="Program Location" />

    <section id="consult-type" sectionTag="fieldset" headerStyle="title"
             headerCode="pihcore.typeOfConsult">
        <div class="section-container">
            <div class="two-columns">
                <p>
                    <repeat>
                        <template>
                            <obs conceptId="PIH:6189" style="checkbox"
                                 answerConceptId="{map}"  answerCode="pihcore.{message}"
                                 toggle="{switch}-area"/>
                        </template>
                        <render map="CIEL:165013" message="gyn" switch="gyn"/>
                        <render map="CIEL:1622" message="prenatal" switch="prenatal"/>
                        <render map="PIH:6261"  message="postnatal" switch="postpartum" />
                        <render map="PIH:5483"  message="familyPlanning.title" switch="fp"/>
                    </repeat>
                </p>

                <p class="side-by-side">
                    <obs id="intake-or-followup"  conceptId="CIEL:164181" style="radio"
                         answerConceptIds="CIEL:164180,PIH:7383"
                         answerCodes="pihcore.new,pihcore.followup">
                        <controls>
                            <when value="CIEL:164180" thenDisplay="#intake-only"/>
                        </controls>
                    </obs>
                </p>
                <br/><br/>
            </div>
        </div>
    </section>

    <section id="referralIn" sectionTag="fieldset" headerStyle="title"
             headerCode="pihcore.refer.title">
        <div class="section-container">
            <p>
                <repeat>
                    <template>
                        <obs conceptId="PIH:Type of referring service"
                             style="checkbox"
                             answerConceptId="{point}" answerCode="{message}"/>
                    </template>
                    <render point="CIEL:1589" message="pihcore.hospitalName"/>
                    <render point="PIH:PRIMARY CARE CLINIC" message="pihcore.location.opd"/>
                    <render point="CIEL:159940" message="pihcore.location.vctCenter" />
                    <render point="PIH:Community meeting" message="pihcore.program.community"/>
                </repeat>
            </p>

            <obs conceptId="PIH:Type of referring service" style="checkbox"
                 answerConceptId="PIH:OTHER"
                 commentFieldCode="zl.pastMedicalHistory.specifyLabel"/>

        </div>

    </section>

    <section id="vitals" sectionTag="fieldset"
             headerStyle="title" headerCode="pihcore.vitalSigns">
        <div class="section-container">
            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.triageLevel"/>
                </label>

                <obs conceptId="PIH:Triage color classification" style="radio"
                     answerConceptIds="PIH:Triage red,PIH:Yellow,PIH:Triage green"
                     answerSeparator="" />
            </p>

            <!-- Todo:  UHM-5191 Add previous vital signs
            <table>
                <tr>
                    <td>
                        <label>
                            <uimessage code="mirebalais.mostRecentVitals.label" />
                        </label>
                        <label>
                            <uimessage code="mirebalais.vitals.respiratoryRate.short.title" />:
                            <lookup expression="fn.latestObs('CIEL:5242')"/>
                            <br/>

                        </label>
                    </td>
                </tr>
            </table>
            -->
        </div>
        <br/>

        <div class="section-container">

            <fieldset field-separator=" / ">
                <p class="left">
                    <uimessage code="mirebalais.vitals.bloodPressure.short.title"/>
                </p>
                <p class="left">
                    <obs conceptId="CIEL:5085" id="bp_systolic"/>
                </p>
                <p class="left">
                    /
                </p>
                <p class="left">
                    <obs conceptId="CIEL:5086" id="bp_diastolic" />
                </p>
                <p class="left">
                    mm/Hg
                </p>
            </fieldset>

            <div class="two-columns">
                <p>
                    <label>
                        <uimessage code="mirebalais.vitals.short.heartRate.title"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5087" id="heart_rate"
                             showUnits="emr.units.perMinute" unitsCssClass="append-to-value"/>
                    </span>
                </p>

                <p>
                    <label>
                        <uimessage code="mirebalais.vitals.respiratoryRate.short.title"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5242" id="respiratory_rate"
                             showUnits="emr.units.perMinute" unitsCssClass="append-to-value"/>
                    </span>
                </p>

                <p>
                    <label>
                        <uimessage code="Temp"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5088" id="temperature_c"
                             showUnits="emr.units.degreesCelsius" unitsCssClass="append-to-value"/>
                    </span>
                </p>

                <p>
                    <label>
                        <uimessage code="o2Sat"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5092" id="o2_sat"
                             showUnits="emr.units.percent" unitsCssClass="append-to-value"/>
                    </span>
                </p>
            </div>
        </div>
    </section>

    <section id="chief-complaint" sectionTag="fieldset" headerStyle="title"
             headerCode="pihcore.chiefComplaint.title">
        <div class="section-container">
            <p>
                <label>
                    <uimessage code="pihcore.history.presentingHistory.title" />
                </label>
                <obs conceptId="PIH:PRESENTING HISTORY" style="textarea" id="presenting-history"/>
            </p>
        </div>
    </section>

    <div id="intake-only">
    <section id="habits" sectionTag="fieldset"
             headerStyle="title" headerCode="pihcore.habits">
        <div class="section-container">
            <p class="side-by-side">
                <!-- Alcohol use -->
                <label>
                    <uimessage code="Alcohol"/>:
                </label>
                <obs conceptId="CIEL:159449" answerConceptIds="CIEL:159450,CIEL:159452,CIEL:1090"
                     style="radio"  />
                <br/>

                <!-- Tobacco -->
                <label position="left">
                    <uimessage code="pihcore.tobacco"/>:
                </label>
                <obs conceptId="CIEL:163731"
                     answerConceptIds="CIEL:159450,CIEL:159452,CIEL:1090"
                     style="radio"  />
                <br/>

                <!-- Drug use -->
                <label>
                    <uimessage code="pihcore.drugs"/>:
                </label>
                <obs conceptId="CIEL:162556" answerConceptIds="CIEL:159450,CIEL:159452,CIEL:1090"
                     style="radio" />
                <br/>

                <label>
                    <uimessage code="pihcore.habits.drugName"/>
                </label>
                <span class="small">
                    <obs conceptId="PIH:6489"/>
                </span>
            </p>
        </div>
    </section>

    <section id="current-medications" sectionTag="fieldset" headerStyle="title"
             headerCode="zl.consultNote.currentMedications.title">
        <div class="section-container">
            <!-- Médicaments actuels -->
            <repeat>
                <template>
                    <obs conceptId="CIEL:1193" answerConceptId="{drug}" />
                </template>
                <render drug="CIEL:73624" message="Clotrimoazole" />
                <render drug="CIEL:461" message="Multivitamin" />
                <render drug="CIEL:104677" message="Folate/Iron" />
                <!-- ToDo:  Change from PIH:251 to CIEL:79723 -->
                <render drug="CIEL:79723" message="AMD/Methyldopa" />
                <render drug="CIEL:79831" message="Miconazole"/>
                <render drug="CIEL:86339" message="Vitamin A" />
                <render drug="CIEL:71589" message="Vitamin C"/>
                <render drug="CIEL:76613" message="Folic acid" />
                <render drug="CIEL:70116" message="Paracetamol" />
                <render drug="CIEL:493"   message="Calamine" /> <!-- CIEL:72621? -->
                <render drug="CIEL:450"   message="Augmentin" />
                <render drug="CIEL:71160" message="Amoxicillin" />
                <render drug="CIEL:71780" message="Azithromycin" />
                <render drug="CIEL:79782" message="Metronidazole" />
                <render drug="CIEL:73006" message="Cefixine" />
                <render drug="CIEL:5622"  message="Other" />
            </repeat>

            <p>
                <obs conceptId="PIH:CURRENT MEDICATIONS" style="textarea"/>
            </p>
        </div>
    </section>

    <section id="patient-history" sectionTag="fieldset" headerStyle="title"
             headerCode="zl.consultNote.patientHistory.title">
        <div class="section-container">
            <!-- ANTECEDENTS PERSONNELS / HABITUDES -->

            <div class="two-columns">
                <pastMedicalHistoryCheckbox concept="CIEL:117703" name="sickle cell"/>
                <pastMedicalHistoryCheckbox concept="PIH:HEART DISEASE" specify="true" class="medicalHistoryText patientHistory" />
                <pastMedicalHistoryCheckbox concept="CIEL:142474" name="type 1 DM"/>
                <pastMedicalHistoryCheckbox concept="CIEL:142473" name="type 2 DM"/>
                <pastMedicalHistoryCheckbox concept="CIEL:1449"   name="gestational DM"/>
                <pastMedicalHistoryCheckbox concept="PIH:HYPERTENSION" label="pihcore.medicalhistory.hypertension"/>
                <pastMedicalHistoryCheckbox concept="PIH:ASTHMA"/>
                <pastMedicalHistoryCheckbox concept="PIH:SEXUALLY TRANSMITTED INFECTION" label="pihcore.medicalhistory.sti"
                                            specify="true" class="medicalHistoryText patientHistory"/>
                <pastMedicalHistoryCheckbox concept="PIH:TUBERCULOSIS"/>
                <pastMedicalHistoryCheckbox concept="CIEL:138405" label="pihcore.lab.hiv.title"/>
                <pastMedicalHistoryCheckbox concept="CIEL:116128" name="malaria" />
                <br/><br/>
            </div>

            <div class="two-columns">
                <pastMedicalHistoryCheckbox concept="CIEL:113859"   name="gestational htn"/>
                <pastMedicalHistoryCheckbox concept="PIH:47" />
                <pastMedicalHistoryCheckbox concept="PIH:Eclampsia" />

                <pastMedicalHistoryCheckbox concept="PIH:SURGERY" specify="true" class="medicalHistoryText patientHistory"/>
                <pastMedicalHistoryCheckbox concept="PIH:Traumatic Injury" specify="true" class="medicalHistoryText patientHistory"/>
                <pastMedicalHistoryCheckbox concept="PIH:OTHER" code="pihcore.other" specify="true" class="medicalHistoryText patientHistory"/>

            </div>
        </div>
    </section>

    <section id="family-history" sectionTag="fieldset" headerStyle="title"
             headerCode="zl.consultNote.familyHistory.title">
        <div class="section-container">
            <!-- ANTECEDENTS HEREDO-COLLATERAUX -->
            <familyHistoryRelativeCheckboxes concept="PIH:ASTHMA" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:HEART DISEASE" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:DIABETES" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:EPILEPSY" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="CIEL:117635" comment="Hémoglobinopathie"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:HYPERTENSION" label="pihcore.medicalhistory.hypertension"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:TUBERCULOSIS" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <br/>
            <familyHistoryRelativeCheckboxes id="familyCancer" class="medicalHistoryText famHistory"
                                             concept="CIEL:116031" label="Cancer"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"
                                             specify="true"/>

            <br/>
            <familyHistoryRelativeCheckboxes id="familyOther" class="medicalHistoryText famHistory"
                                             concept="PIH:OTHER" code="pihcore.other"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"
                                             specify="true"/>
        </div>
    </section>
    </div>

    <section id="hiv" sectionTag="fieldset"
             headerStyle="title" headerCode="pihcore.hivTB">
        <div class="section-container">
            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.ifHIVpatient" />, <uimessage code="pihcore.onARV"/>
                </label>
                <obs id="on-arv" conceptId="CIEL:160119" style="radio"
                     answerConceptIds="CIEL:1065,CIEL:1066">
                    <controls>
                        <when value="CIEL:1065" thenDisplay="#art-startdate"/>
                    </controls>
                </obs>
                <div id="art-startdate" class="two-columns">
                    <label>
                        <uimessage code="pihcore.hiv.startDateARV" />
                    </label>
                    <obs conceptId="CIEL:159599" />

                    <label>
                        <uimessage code="pihcore.regimen" />
                    </label>
                    <obs conceptId="CIEL:166086" />
                </div>
            </p>

            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.hivTestPast3mo" />?
                </label>
                <obs conceptId="PIH:13256" style="radio"
                     answerConceptIds="CIEL:1065,CIEL:1066,CIEL:1067" />
                <br/>
                <label>
                    <i>
                        <uimessage code="pihcore.ifNoUnknownVCT" />
                    </i>
                </label>
            </p>

            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.lab.viral_load"/>
                </label>
                <obs id="viral-load" conceptId="CIEL:1305" style="radio"
                     answerConceptIds="CIEL:1301,CIEL:1306"
                     answerCodes="pihcore.lab.detected,pihcore.lab.undetected" >
                    <controls>
                        <when value="CIEL:1301" thenDisplay="#viral-load-numeric"/>
                    </controls>
                </obs>

                <div id="viral-load-numeric">
                    <obs conceptId="CIEL:856" showUnits="true"
                         placeholder="Enter value" />
                </div>
            </p>

            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.ifTbTreatment" />
                </label>
                <obs id="tb-treatment" conceptId="CIEL:5965" style="radio"
                     answerConceptIds="CIEL:1267,CIEL:163339"
                     answerCodes="pihcore.treatCompleted,pihcore.incomplete">
                    <controls>
                        <when value="CIEL:1267" thenDisplay="#tb-treatment-end-date"/>
                    </controls>
                </obs>

                <div id="tb-treatment-end-date">
                    <label>
                        <uimessage code="pihcore.treatmentEndDate" />
                    </label>
                    <obs conceptId="CIEL:159431" />
                </div>
            </p>

        </div>
    </section>

    <section id="family-plan-section" sectionTag="fieldset"
             headerStyle="title" headerCode="pihcore.familyPlanning.title">

        <div id="fp-area" class="section-container">
            <div class="two-columns">
                <obs conceptId="CIEL:163560" style="checkbox"
                     answerConceptId="CIEL:1382" answerCode="pihcore.mch.counselling.familyPlanning" />
                <br/>
                <obs conceptId="CIEL:965" style="checkbox"
                     answerConceptId="CIEL:1065" answerCode="pihcore.currentlyUsing"/>
            </div>

            <table>
            <tr>
                <td>
                    <label>
                        <uimessage code="pihcore.familyPlanningHistory.title"/>
                    </label>
                </td>
                <td>
                    <label>
                        <uimessage code="pihcore.startDate"/>
                    </label>
                </td>
                <td>
                    <label>
                        <uimessage code="pihcore.endDate"/>
                    </label>
                </td>
            </tr>

            <repeat>
                <template>
                    <obsgroup groupingConceptId="PIH:Family planning history construct">
                        <tr>
                            <td id="{tag}-fp">
                                <obs conceptId="CIEL:374"
                                     answerConceptId="{fpMethod}"
                                     answerCode="{comment}"
                                     style="checkbox"
                                     toggle="{id: '{tag}-date', style: 'dim'}"
                                />
                            </td>
                            <td class="{tag}-date">
                                <obs conceptId="CIEL:163757"/>
                            </td>
                            <td class="{tag}-date">
                                <obs conceptId="CIEL:163758" allowFutureDates="true"/>
                            </td>
                        </tr>
                    </obsgroup>
                </template>
                <render fpMethod="CIEL:159783" comment="COC" tag="COC"/>
                <render fpMethod="CIEL:80784"  comment="COP" tag="COP"/>
                <render fpMethod="CIEL:907"    comment="Depo-provera" tag="depo"/>
                <render fpMethod="CIEL:1873"   comment="Implant" tag="implant"/>
                <render fpMethod="CIEL:5275"   comment="pihcore.fp.iud" tag="iud"/>
                <render fpMethod="CIEL:5277"   comment="pihcore.fp.rhythm" tag="rhythm"/>
                <render fpMethod="CIEL:136163" comment="pihcore.fp.breast" tag="mama"/>
                <render fpMethod="CIEL:190"    comment="Condoms" tag="rubber"/>
                <render fpMethod="CIEL:1472"   comment="pihcore.fp.tubalLig" tag="tubal"/>
            </repeat>
            </table>

            <h3>
                <uimessage code="pihcore.fpMethod" />
            </h3>

            <p class="side-by-side">
                <obsgroup groupingConceptId="PIH:Family planning construct">
                    <obs conceptId="CIEL:374"
                         answerConceptIds="CIEL:159783,CIEL:80784,CIEL:907,CIEL:1873,CIEL:5275,CIEL:5277,CIEL:136163,CIEL:190,CIEL:1472"
                         answerCodes="COC,COP,Depo-provera,Implant,pihcore.fp.iud,pihcore.fp.rhythm,pihcore.fp.breast,Condoms,pihcore.fp.tubalLig"
                         style="radio" />
                    <div class="two-columns">
                        <label>
                            <uimessage code="pihcore.startDate"/>:
                        </label>
                        <obs conceptId="CIEL:163757" />

                        <label>
                            <uimessage code="pihcore.endDate"/>:
                        </label>
                        <obs conceptId="CIEL:163758" />
                    </div>
                </obsgroup>
            </p>

            <p>
                <label>
                    <uimessage code="pihcore.dateImplant"/>:
                </label>
                <obs conceptId="PIH:3203" />
            </p>
        </div>
    </section>

    <section id="obgyn-section" sectionTag="fieldset"
             headerStyle="title" headerCode="OB/GYN">
        <div class="section-container">

            <div class="two-columns">
                <!-- Last menstrual period (LMP or DDR) -->
                <p>
                    <label>
                        <uimessage code="pihcore.pregnancy.lastPeriod"/>
                    </label>
                    <span class="small">
                        <obs id="lastPeriodDate" conceptId="CIEL:1427" allowFutureDates="false"/>
                    </span>
                </p>

                <!-- Due date (DPA) -->
                <p>
                    <label>
                        <uimessage code="pihcore.pregnancy.dueDate"/>
                    </label>
                    <span class="small">
                        <obs conceptId="CIEL:5596" allowFutureDates="true"/>
                    </span>
                </p>
            </div>

            <div id="calculated-edd-and-gestational" class="two-columns hidden">
                <p>
                    <span id="calculated-gestational-age-wrapper">
                        <span id="calculated-gestational-age-label">
                            <uimessage code="pihcore.calculatedGestationalAge"/>:&#160;
                        </span>
                        <span id='calculated-gestational-age-value' class="value"></span>
                    </span>
                </p>
                <p>
                    <span id="calculated-edd-wrapper">
                        <span id="calculated-edd-label">
                            <uimessage code="pihcore.calculatedEstimatedDeliveryDate"/>:&#160;
                        </span>
                        <span id='calculated-edd' class="value"></span>
                    </span>
                </p>
            </div>

            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.mch.trimesterAtEnrollment" />
                </label>

                <obs conceptId="PIH:11661" style="radio"
                     answerConceptIds="CIEL:1721,CIEL:1722,CIEL:1723" />
                <!-- ToDo: Ask team if they want the time range for trimester
                     answerCodes="pihcore.mch.firstTri,pihcore.mch.secondTri,pihcore.mch.thirdTri"
                -->

            </p>

            <div class="two-columns">
                <p>
                    <label>
                        <uimessage code="pihcore.durationMenstCycle"/>
                    </label>
                    <obs conceptId="CIEL:160597" />
                    <br/>

                    <label>
                        <uimessage code="pihcore.durationMenses"/>
                    </label>
                    <obs conceptId="CIEL:163732" />
                </p>
            </div>

            <div class="four-columns">
                <p>
                    <label>
                        <uimessage code="pihcore.mch.grava"/>
                    </label>
                    <obs conceptId="CIEL:5624" required="true" id="gravidaInput"/>
                </p>
                <p>
                    <label>
                        <uimessage code="pihcore.mch.para"/>
                    </label>
                    <obs conceptId="CIEL:1053" required="true"/>
                </p>
                <p>
                    <label>
                        <uimessage code="pihcore.mch.abortus"/>
                    </label>
                    <obs conceptId="CIEL:1823" required="true"/>
                </p>
                <p>
                    <label>
                        <uimessage code="pihcore.mch.living"/>
                    </label>
                    <obs conceptId="CIEL:1825" required="true"/>
                </p>
            </div>

            <div class="two-columns">
                <p class="side-by-side">
                    <label>
                        <uimessage code="Menstruation" />
                    </label>
                    <obs conceptId="CIEL:160600" style="radio"
                         answerConceptIds="CIEL:1065,CIEL:1066"
                         answerCodes="pihcore.regular,pihcore.irregular" />

                    <br/><br/>
                    <!-- Dysmenorrhea -->
                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                        <obs conceptId="PIH:DIAGNOSIS" style="checkbox" answerConceptId="CIEL:127" />
                    </obsgroup>
                </p>
            </div>

            <div class="three-columns">
                <label>
                    <uimessage code="pihcore.ageMenarche" />
                </label>
                <obs conceptId="CIEL:160598" />

                <label>
                    <uimessage code="pihcore.age1stSexualInter" />
                </label>
                <obs conceptId="CIEL:163587" />

                <label>
                    <uimessage code="pihcore.numSexPartners" />
                </label>
                <obs conceptId="CIEL:5570" />
            </div>
            <br/>

            <table>
                <tr>
                    <th colspan="3">
                        <uimessage code="pihcore.mch.pregnancyHistory" />
                    </th>
                </tr>
                <tr>
                    <th>
                        <uimessage code="pihcore.pregOrder" />
                    </th>
                    <th>
                        <uimessage code="pihcore.mch.deliveryType" />
                    </th>
                    <th>
                        <uimessage code="pihcore.outcome" />
                    </th>
                </tr>
                <repeat>
                    <template>
                        <obsgroup groupingConceptId="CIEL:163588">
                        <tr>
                            <td>
                                <obs conceptId="CIEL:163460" defaultValue="{count}"/>
                            </td>
                            <td>
                                <obs conceptId="PIH:11663"
                                     answerConceptIds="CIEL:162595,CIEL:161631,CIEL:155884,CIEL:1637,CIEL:159728"/>
                            </td>
                            <td>
                                <obs conceptId="CIEL:161033" />
                            </td>
                        </tr>
                        </obsgroup>
                    </template>
                    <render count="1" />
                    <render count="2" />
                    <render count="3" />
                    <render count="4" />
                    <render count="5" />
                    <render count="6" />
                    <render count="7" />
                    <render count="8" />
                    <render count="9" />
                    <render count="10" />
                </repeat>
                <tr>

                </tr>
            </table>
        </div>
    </section>

    <section id="postpartum-section" sectionTag="fieldset"
             headerStyle="title" headerCode="pihcore.postnatal">

        <div id="postpartum-area" class="section-container">
            <p>
                <label>
                    <uimessage code="pihcore.numPostpartumVisits" />
                </label>
                <obs conceptId="CIEL:159893"  />
            </p>
        </div>
    </section>

    <section id="risk-factors" sectionTag="fieldset"
              headerStyle="title" headerCode="pihcore.mch.riskFactors">

        <div class="section-container">
            <div class="two-columns">
                <!-- Risk factors for mother -->
                <!-- Anemia -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:121629" style="checkbox"/>
                <!-- Hypertension -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:117399" style="checkbox"/>
                <!-- Edema -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:460" style="checkbox"/>
                <!-- Antepartum hemorrhage -->
                <obs conceptId="CIEL:160079" answerConceptId="PIH:ANTEPARTUM HEMORRHAGE" style="checkbox"/>
                <!-- No weight gain -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:140707"
                     answerCode="pihcore.noWeightChange" style="checkbox" />
                <!-- Diabetes -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:119481" style="checkbox"/>
                <!-- C-section -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:163155"
                     answerCode="pihcore.mch.previousCSection" style="checkbox"/>
                <!-- HIV -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:138405"
                     answerCode="HIV" style="checkbox"/>
                <!-- ToDo:  Grande parité (CIEL:163120 or 117749) -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:117749" style="checkbox"/>
                <!-- Multiple gestation -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:115491" style="checkbox"/>

                <!-- Placental abruption -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:130108" style="checkbox"/>
                <!-- Placenta previa -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:114127" style="checkbox"/>
                <!-- Fetal death -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:140399" style="checkbox"/>
                <!-- Malpresentation of fetus -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:115939" style="checkbox"/>
                <!-- Syphilis -->
                <obs conceptId="CIEL:160079" answerConceptId="CIEL:112493"
                     style="checkbox"/>

                <obs conceptId="CIEL:160079" answerConceptId="PIH:OTHER"
                     commentFieldLabel="  " style="checkbox"/>

                <!-- ToDo: Change to mapping PIH:11930 -->
                <!-- ToDo: Specify other high risk factor, but doesn't work with text that doesn't match
                <obs conceptId="CIEL:160079" answerConceptSetIds="1da49fd7-b1fe-4053-8309-061c37ea56be"
                     style="autocomplete" />
                     -->
            </div>
        </div>
    </section>

    <!-- Mental Health -->
    <section id="mental-health" sectionTag="fieldset"
             headerStyle="title" headerCode="pihcore.mentalhealth.title">
        <div class="section-container">

            <repeat>
                <template>
                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                        <obs conceptId="PIH:DIAGNOSIS" style="checkbox" answerConceptId="{mh-answer}" />
                    </obsgroup>
                </template>
                <render name="Depression"    mh-answer="CIEL:119537" />
                <render name="Schizophrenia" mh-answer="CIEL:113155" />
                <render name="PTSD"          mh-answer="CIEL:113881" />
                <render name="Gender-based violence" mh-answer="CIEL:165088" />
            </repeat>

        </div>
    </section>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <button id="next" type="button" class="submitButton confirm right"><uimessage code="emr.next"/><i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i></button>
            <button id="submit" class="submitButton confirm right"><uimessage code="mirebalais.save"/><i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i></button>
            <button id="cancel" type="button" class="cancel"><uimessage code="emr.cancel"/></button>
        </div>
    </ifMode>

</htmlform>
