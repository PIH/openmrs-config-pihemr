<htmlform formUuid="4d778ef4-0620-11e5-a6c0-1697f925ec7b" formName="Lab results"
          formEncounterType="4d77916a-0620-11e5-a6c0-1697f925ec7b" formVersion="1.0">

    <postSubmissionAction class="org.openmrs.module.pihcore.htmlformentry.action.SetObsDatesToSpecimenCollectionDateAction"/>

    <style type="text/css">

        .section-header {
            margin-top: 1.5em;
        }

        p.radio > * {
            display: inline;
            float: none !important;
            min-width: initial;
        }

        .section-container input[type="checkbox"] {
            margin: 0px 5px; /* changed values to vertical, horizontal */
            top: 5px; /* added to offset the checkbox position to line up */
        }

        #viral-load > * {
            display: inline !important;
            float: none !important;
            min-width: initial;
        }

        #hiv-rapid-test > * {
            display: inline !important;
            float: none !important;
            min-width: initial;
        }


        #tb-skin-test-qual > * {
            display: inline !important;
            float: none !important;
            min-width: initial;
        }

        @media (max-width: 991px) { /* Bootstrap "lg" */

            ul#formBreadcrumb.options {
                display: flex;
                float: inherit;
                width: inherit;
                vertical-align: inherit;
                background: #fff;
                border-right: 3px solid #f9f9f9;
            }

            ul#formBreadcrumb li:first-child {
                flex-basis: 85%;
            }

            ul#formBreadcrumb li:first-child ul {
                display: flex;
                flex-wrap: wrap;
            }

            ul#formBreadcrumb li:first-child ul li {
                flex-basis: 160px;
            }

            ul#formBreadcrumb > li:last-child {
                display: flex;
                align-items: center;
                align-self: center;
                height: 45px;
                color: #444;
                border: 1px solid #CCC;
                background: #DDD;
                box-shadow: 0 0 5px -1px rgba(0,0,0,0.2);
                vertical-align: middle;
                padding: 5px;
                text-align: center;
            }

            ul#formBreadcrumb > li:last-child:active {
                color: blue;
                box-shadow: 0 0 5px -1px rgba(0,0,0,0.6);
            }
        }

    </style>

    <ifMode mode="VIEW" include="false">
        <script type="text/javascript">

            var toggleViralLoadFields = function() {
                if (getValue('viral-load.value') === '<lookup expression="fn.getConcept('CIEL:1301').id" />') {
                    NavigatorController.getFieldById(getField('viral-load-numeric.value').attr('id')).enable();
                    NavigatorController.getFieldById(getField('detected-lower-limit.value').attr('id')).disable();
                }
                else if (getValue('viral-load.value') === '<lookup expression="fn.getConcept('CIEL:1306').id" />') {
                    NavigatorController.getFieldById(getField('viral-load-numeric.value').attr('id')).disable();
                    NavigatorController.getFieldById(getField('detected-lower-limit.value').attr('id')).enable();
                }
                else {
                    NavigatorController.getFieldById(getField('viral-load-numeric.value').attr('id')).disable();
                    NavigatorController.getFieldById(getField('detected-lower-limit.value').attr('id')).disable();
                }
            }

            jq(function() {
                getField('encounter-date.value').change(function(evt) {
                    setValue('test-date.value', evt.target.value);
                    getField('specimen-collection-date.value').datepicker('option', 'maxDate', evt.target.value);
                });
                setValue('test-date.value', new Date());
                getField('encounter-date.value').datepicker('option', 'maxDate', new Date());
                getField('specimen-collection-date.value').datepicker('option', 'maxDate', new Date());
                getField('viral-load.value').change(toggleViralLoadFields);
                toggleViralLoadFields();
            });

        </script>
    </ifMode>

    <ifMode mode="ENTER">
        <script type="text/javascript">
            jq(function() {
                // when below detectable limit is selected, set default value to 839 copies / ml since this is the standard for the Haiti national
                getField('viral-load.value').change(function() {
                    if (getValue('viral-load.value') === '<lookup expression="fn.getConcept('CIEL:1306').id" />') {
                        setValue('detected-lower-limit.value', 839);
                    }
                });
            });
        </script>
    </ifMode>

    <section id="labResults" sectionTag="section" headerStyle="title" headerCode="pihcore.lab.lab_results.title">

        <fieldset class="multi-line-confirmation" field-separator=" ">
            <!-- field separator is set as a workaround for the super-hack, see below -->

            <legend>
                <uimessage code="pihcore.lab.overview"/>
            </legend>
            <h3>
                <uimessage code="pihcore.lab.overview"/>
            </h3>

            <!-- this is a super-hack to get around the fact that if the date is first field in a form, the
                 datepicker opens immediately, AND in this case we are getting some odd interactions between this
                 first datepicker and the hidden datepicker at the bottom form for encounter date -->
            <field>
                <span class="ui-helper-hidden-accessible"><input type="text"/></span>
            </field>
            <div>
                <label for="location">
                    <uimessage code="emr.locationRequired"/>
                </label>
                <div class="required">
                    <encounterLocation default="SessionAttribute:emrContext.sessionLocationId" tags="Lab Results Location"/>
                </div>
            </div>
            <br/>
            <div>
                <label for="sample-id">
                    <uimessage code="pihcore.lab.sample_id"/>
                </label>
                <span class="small">
                    <field>
                        <obs  id="sample-id" conceptId="CIEL:162086"
                              placeholder="Enter Sample ID"/>
                    </field>
                </span>
            </div>
            <br/><br/>
            <div>
                <label for="test-date">
                    <uimessage code="pihcore.lab.test_date"/>
                </label>
                <div class="small">
                    <encounterDate id="encounter-date" default="now" />
                    <div style="display: none;">
                        <obs id="test-date" conceptId="PIH:DATE OF LABORATORY TEST" />
                    </div>
                </div>
            </div>
            <div>
                <label for="specimen-collection-date">
                    <uimessage code="pihcore.lab.specimen_collection_date"/>
                </label>
                <div class="small required">
                    <obs id="specimen-collection-date"
                         conceptId="PIH:SPUTUM COLLECTION DATE"
                         allowTime="false" />

                    <div class="section-container">
                        <obs conceptId="PIH:11781" answerConceptId="PIH:YES"
                             style="checkbox" answerCode="pihcore.date_estimated"/>
                    </div>
                </div>
            </div>
        </fieldset>

        <fieldset class="multi-line-confirmation">
            <legend>
                <uimessage code="COVID-19"/>
            </legend>
            <h3>
                <uimessage code="COVID-19"/>
            </h3>

            <p>
                <label for="covid-ab">
                    <uimessage code="pihcore.antibodyTest"/>
                </label>
                <span>
                    <field>
                        <obs conceptId="CIEL:165853" id="covid-ab"
                             answerConceptIds="CIEL:664,CIEL:165855,CIEL:165856,CIEL:165857,CIEL:163611" />
                    </field>
                </span>

                <label for="covid-ag">
                    <uimessage code="pihcore.antigenTest"/>
                </label>
                <span>
                    <field>
                        <obs conceptId="CIEL:165852" id="covid-ag"
                             answerConceptIds="CIEL:664,CIEL:703,CIEL:163611"/>
                    </field>
                </span>

                <label for="covid-pcr">
                    <uimessage code="pihcore.rtPCR"/>
                </label>
                <span>
                    <field>
                        <obs conceptId="CIEL:165840" id="covid-pcr"
                             answerConceptIds="CIEL:664,CIEL:703,CIEL:163611"/>
                    </field>
                </span>

                <label for="covid-xpert">
                    <uimessage code="GeneXpert"/>
                </label>
                <span>
                    <field>
                        <obs conceptId="CIEL:165865" id="covid-xpert"
                             answerConceptIds="CIEL:664,CIEL:703,CIEL:163611"/>
                    </field>
                </span>
            </p>
        </fieldset>

        <fieldset class="multi-line-confirmation">
            <legend>
                <uimessage code="pihcore.lab.hematology.title"/>
            </legend>
            <h3>
                <uimessage code="pihcore.lab.hematology.title"/>
            </h3>

            <p>
                <label for="white-blood-cell">
                    <uimessage code="pihcore.lab.white_blood_cell"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="white-blood-cell" conceptId="PIH:WHITE BLOOD CELLS" showUnits="true"/>
                    </field>
                </span>
                <label for="red-blood-cell">
                    <uimessage code="pihcore.lab.red_blood_cell"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="red-blood-cell" conceptId="CIEL:679" showUnits="true"/>
                    </field>
                </span>

                <label for="hemoglobin">
                    <uimessage code="pihcore.lab.hemoglobin"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="hemoglobin" conceptId="PIH:HEMOGLOBIN" showUnits="true"/>
                    </field>
                </span>

                <label for="hemoglobin-a1c">
                    HbA1c
                </label>
                <span class="small">
                    <field>
                        <obs id="hemoglobin-a1c" conceptId="PIH:HbA1c" showUnits="true"/>
                    </field>
                </span>

                <label for="hematocrit">
                    <uimessage code="pihcore.lab.hematocrit"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="hematocrit" conceptId="PIH:HEMATOCRIT" showUnits="true"/>
                    </field>
                </span>

                <label for="mcv">
                    <uimessage code="pihcore.lab.mcv"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="mcv" conceptId="CIEL:851" showUnits="true"/>
                    </field>
                </span>
                <label for="mch">
                    <uimessage code="pihcore.lab.mch"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="mch" conceptId="CIEL:1018" showUnits="true"/>
                    </field>
                </span>
                <label for="mchc">
                    <uimessage code="pihcore.lab.mchc"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="mchc" conceptId="CIEL:1017" showUnits="true"/>
                    </field>
                </span>

                <label for="platelets">
                    <uimessage code="pihcore.lab.platelets"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="platelets" conceptId="PIH:PLATELETS" showUnits="true"/>
                    </field>
                </span>

                <label for="lymphocyte">
                    <uimessage code="pihcore.lab.lymphocyte"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="lymphocyte" conceptId="PIH:ABSOLUTE LYMPHOCYTE COUNT" showUnits="true"/>
                    </field>
                    <field>
                        (<obs conceptId="PIH:LYMPHOCYTES" showUnits="true"/>)
                    </field>
                </span>

                <label for="neutrophil">
                    <uimessage code="pihcore.lab.neutrophil"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="neutrophil" conceptId="PIH:Absolute Neutrophil Count" showUnits="true"/>
                    </field>
                    <field>
                        (<obs conceptId="PIH:NEUTROPHILS" showUnits="true"/>)
                    </field>
                </span>

                <label for="mxd">
                    <uimessage code="pihcore.lab.mxd"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="mxd" conceptId="CIEL:165578" showUnits="true"/>
                    </field>
                </span>

                <label for="eos-pcent">
                    <uimessage code="pihcore.lab.eosinophil"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="eos-pcent" conceptId="CIEL:1024" showUnits="true"/>
                    </field>
                </span>


                <label for="bas-pcent">
                    <uimessage code="pihcore.lab.basophil"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="bas-pcent" conceptId="CIEL:1025" showUnits="true"/>
                    </field>
                </span>


                <label for="mono-pcent">
                    <uimessage code="pihcore.lab.monocyte"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="mono-pcent" conceptId="CIEL:1023" showUnits="true"/>
                    </field>
                </span>

                <label for="rdw-sd">
                    <uimessage code="pihcore.lab.rdwSd"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="rdw-sd" conceptId="CIEL:165580" showUnits="true"/>
                    </field>
                </span>
                <label for="rdw-cv">
                    <uimessage code="pihcore.lab.rdwCv"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="rdw-cv" conceptId="CIEL:165579" showUnits="true"/>
                    </field>
                </span>

                <label for="esr">
                    <uimessage code="pihcore.lab.esr"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="esr" conceptId="PIH:ERYTHROCYTE SEDIMENTATION RATE" showUnits="true"/>
                    </field>
                </span>

                <label for="pt">
                    <uimessage code="pihcore.lab.pt"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="pt" conceptId="CIEL:161481" showUnits="true"/>
                    </field>
                </span>

                <label for="inr">
                    <uimessage code="pihcore.lab.inr"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="inr" conceptId="PIH:INTERNATIONAL NORMALIZED RATIO"
                             placeholder="Enter value"/>
                    </field>
                </span>

                <label for="ptt">
                    <uimessage code="pihcore.lab.ptt"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="ptt" conceptId="CIEL:161153" showUnits="true"/>
                    </field>
                </span>

                <label for="coag">
                    <uimessage code="pihcore.lab.coagTime"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="coag" conceptId="CIEL:161435" showUnits="true"/>
                    </field>
                </span>

                <label for="bleed-t">
                    <uimessage code="pihcore.lab.bleedTime"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="bleed-t" conceptId="CIEL:161433" showUnits="true"/>
                    </field>
                </span>

                <label for="reticul">
                    <uimessage code="pihcore.lab.reticul"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="reticul" conceptId="CIEL:1327" showUnits="true"/>
                    </field>
                    <field>
                        (<obs id="arc" conceptId="CIEL:166395" showUnits="true"/>)
                    </field>
                </span>

                <label for="blood-type">
                    <uimessage code="pihcore.lab.blood_type"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="blood-type" conceptId="PIH:BLOOD TYPING" />
                    </field>
                </span>

                <label for="sickle-screen">
                    <uimessage code="pihcore.lab.sickleScreen"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="sickle-screen" conceptId="CIEL:160225" />
                    </field>
                </span>

                <label for="sickle-hg-elec">
                    <uimessage code="pihcore.lab.hgElectro"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="sickle-hg-elec" conceptId="CIEL:165544" />
                    </field>
                </span>

            </p>

        </fieldset>

        <fieldset class="multi-line-confirmation">

            <legend>
                <uimessage code="pihcore.lab.biochemistry.title"/>
            </legend>
            <h3>
                <uimessage code="pihcore.lab.biochemistry.title"/>
            </h3>

            <p>
                <label for="glucose">
                    <uimessage code="pihcore.lab.glucose"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="glucose" conceptId="PIH:SERUM GLUCOSE" showUnits="true"/>
                    </field>
                </span>

                <label for="glucose-prandial">
                    <uimessage code="pihcore.lab.glucose-prandial"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="glucose-prandial" conceptId="CIEL:160914" showUnits="true"/>
                    </field>
                </span>

                <label for="glucose-fasting">
                    <uimessage code="pihcore.lab.glucose-fasting"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="glucose-fasting" conceptId="CIEL:160912" showUnits="true"/>
                    </field>
                </span>
            </p>

            <h4>
                <uimessage code="pihcore.lab.liver.panel"/>
            </h4>
            <p>
                <label for="serum-glutamic-oxaloacetic-transaminase">SGOT</label>
                <span class="small">
                    <field>
                        <obs id="serum-glutamic-oxaloacetic-transaminase"
                             conceptId="PIH:SERUM GLUTAMIC-OXALOACETIC TRANSAMINASE" showUnits="true"/>
                    </field>
                </span>

                <label for="serum-glutamic-pyruvic-transaminase">SGPT</label>
                <span class="small">
                    <field>
                        <obs id="serum-glutamic-pyruvic-transaminase"
                             conceptId="PIH:SERUM GLUTAMIC-PYRUVIC TRANSAMINASE" showUnits="true"/>
                    </field>
                </span>

                <label for="bilirubin">
                    <uimessage code="pihcore.lab.bilirubin"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="bilirubin" conceptId="CIEL:655" showUnits="true"/>
                    </field>
                </span>
                <label for="dbilirubin">
                    <uimessage code="pihcore.lab.dBili"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="dbilirubin" conceptId="CIEL:1297" showUnits="true"/>
                    </field>
                </span>
                <label for="ibilirubin">
                    <uimessage code="pihcore.lab.iBili"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="ibilirubin" conceptId="CIEL:163001" showUnits="true"/>
                    </field>
                </span>

                <label for="alk-phos">
                    <uimessage code="pihcore.lab.alk_phos"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="alk-phos" conceptId="PIH:ALKALINE PHOSPHATASE" showUnits="true"/>
                    </field>
                </span>
            </p>

            <br/>
            <h4>
                <uimessage code="pihcore.lab.renal.panel"/>
            </h4>
            <p>
                <label for="urea">
                    <uimessage code="pihcore.lab.urea"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="urea" conceptId="PIH:BLOOD UREA NITROGEN" showUnits="true"/>
                    </field>
                </span>

                <label for="urea-m">
                    <uimessage code="pihcore.lab.ureaMeasured"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="urea-m" conceptId="PIH:12653" showUnits="true"/>
                    </field>
                </span>

                <label for="creatinine-i-stat">
                    <uimessage code="pihcore.lab.creatinine"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="creatinine-i-stat" conceptId="PIH:Creatinine mg per dL" showUnits="true"/>
                    </field>
                </span>

                <label for="uric-acid">
                    <uimessage code="pihcore.lab.uricAcid"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="uric-acid" conceptId="CIEL:159825" showUnits="true"/>
                    </field>
                </span>
            </p>

            <br/>
            <h4>
                <uimessage code="pihcore.lab.lipids.title"/>
            </h4>
            <p>
                <label for="total-chol">
                    <uimessage code="pihcore.lab.total_chol"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="total-chol" conceptId="PIH:12991" showUnits="true"/>
                    </field>
                </span>

                <label for="hdl">
                    <uimessage code="pihcore.lab.hdl"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="hdl" conceptId="PIH:12993" showUnits="true"/>
                    </field>
                </span>

                <label for="ldl">
                    <uimessage code="pihcore.lab.ldl"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="ldl" conceptId="PIH:12992" showUnits="true"/>
                    </field>
                </span>

                <label for="trigly">
                    <uimessage code="pihcore.lab.trigly"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="trigly" conceptId="PIH:12990" showUnits="true"/>
                    </field>
                </span>
            </p>

            <p id="iStat8">
                <h4>
                    <uimessage code="pihcore.lab.electrolyte.panel"/>
                </h4>

                <repeat>
                    <template>
                        <label for="{tag}">
                            <uimessage code="{message}"/>
                        </label>
                        <span class="small">
                            <field>
                                <obs id="{tag}" conceptId="{concept}" showUnits="true" />
                            </field>
                        </span>
                    </template>
                    <render concept="CIEL:1132" message="pihcore.lab.sodium" tag="sodium" />
                    <render concept="CIEL:1133" message="pihcore.lab.potassium" tag="potassium" />
                    <render concept="CIEL:1134" message="pihcore.lab.chloride" tag="chloride" />
                    <render concept="CIEL:166038" message="pihcore.lab.calcium" tag="calcium" />
                    <render concept="CIEL:1135" message="pihcore.lab.co2" tag="co2" />
                    <render concept="CIEL:166396" message="Fe" tag="iron" />
                    <render concept="CIEL:166397" message="Mg" tag="magnes" />
                    <render concept="CIEL:1013" message="Lipase" tag="lipase" />
                </repeat>
            </p>

        </fieldset>

        <fieldset class="multi-line-confirmation">

            <legend>
                <uimessage code="pihcore.lab.serology.title"/>
                (<uimessage code="pihcore.lab.hiv.title"/>)
            </legend>
            <h3>
                <uimessage code="pihcore.lab.serology.title"/>
            </h3>

            <!--         <includeIf velocityTest="$user.hasPrivilege('Task: emr.hivTestResults')"> -->

            <h4>
                <uimessage code="pihcore.lab.hiv.title"/>
            </h4>

            <p>
                <label for="hiv-rapid-test">
                    <uimessage code="pihcore.lab.hivRapid"/>
                </label>
                <obsgroup groupingConceptId="PIH:13135">
                    <span class="small">
                        <field>
                            <obs id="hiv-rapid-test" conceptId="CIEL:163722" style="radio"
                                 answerConceptIds="CIEL:703,CIEL:664,CIEL:1138" />
                        </field>
                    </span>
                    <div class="small">
                        <field>
                            <obs id="hiv-rapid-control"
                                 conceptId="CIEL:164860" style="checkbox"
                                 answerConceptId="CIEL:1065"
                                 answerCode="pihcore.lab.controlTest"/>
                        </field>
                    </div>
                </obsgroup>
            </p>

            <p>
                <label for="cd4-count-test">
                    <uimessage code="pihcore.lab.cd4Count"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="cd4-count-test" conceptId="CIEL:5497" showUnits="true"/>
                    </field>
                </span>

                <label for="cd4-percent-test">
                    <uimessage code="pihcore.lab.cd4Percent" />
                </label>
                <span class="small">
                    <field>
                        <obs id="cd4-percent-test" conceptId="CIEL:730" showUnits="true" />
                    </field>
                </span>
            </p>
            <br/>

            <p>
                <!-- For children only? -->
                <label for="hiv-pcr">
                    <uimessage code="pihcore.lab.hivpcr"/>
                </label>
                <span>
                    <field>
                        <obs id="hiv-pcr" conceptId="CIEL:1030"
                             answerConceptIds="CIEL:703,CIEL:664,CIEL:1138" showCommentField="true" commentFieldLabel="Comments:"/>
                    </field>
                </span>
            </p>

            <p>
                <label for="viral-load">
                    <uimessage code="pihcore.lab.viral_load"/>
                </label>
                <obsgroup groupingConceptId="PIH:HIV viral load construct">
                    <span class="small">
                        <field>
                            <obs id="viral-load" conceptId="CIEL:1305" style="radio" answerConceptIds="CIEL:1301,CIEL:1306" answerCodes="pihcore.lab.detected,pihcore.lab.undetected" />
                        </field>
                    </span>
                    <br/>
                    <div class="small">
                        <label for="viral-load-numeric">
                            <uimessage code="pihcore.lab.viral_load"/>
                        </label>
                        <field class="required">
                            <obs
                                id="viral-load-numeric"
                                conceptId="CIEL:856"
                                showUnits="false"
                                placeholder="Enter value"
                            />
                        </field>
                        <uimessage code="pihcore.lab.viralLoad.units"/>
                    </div>

                    <div class="small" >
                        <label for="detected-lower-limit">
                            <uimessage code="pihcore.lab.viralLoadLowerLimitOfDetection"/>
                        </label>
                        <field>
                            <obs id="detected-lower-limit"
                                 conceptId="PIH:11548"
                                 showUnits="false"
                                 placeholder="Enter value"/>
                        </field>
                        &lt; <uimessage code="pihcore.lab.viralLoad.units"/>
                    </div>

                    <div class="small">
                        <label for="hiv-test-reason">
                            <uimessage code="pihcore.reason"/>
                        </label>
                        <field>
                            <obs id="hiv-test-reason" conceptId="CIEL:164126"
                                answerConceptIds="CIEL:166058,CIEL:166059"
                                answerCodes="pihcore.routine,pihcore.targeted"
                            />
                        </field>
                    </div>

                </obsgroup>

            </p>

            <br/>
            <h4>
                <uimessage code="pihcore.other"/>
            </h4>

            <p>
                <label for="crag">
                    <uimessage code="CrAg"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="crag" conceptId="CIEL:163613" style="text"
                             cols="40" rows="1"/>
                    </field>
                </span>

                <repeat>
                    <template>
                        <label for="{tag}">
                            <uimessage code="{message}"/>
                        </label>
                        <span class="small">
                            <field>
                                <obs id="{tag}" conceptId="{concept}" />
                            </field>
                        </span>
                    </template>
                    <render concept="CIEL:1945"   message="pihcore.lab.pregnancy" tag="b-hcg"/>
                    <render concept="CIEL:1619"   message="pihcore.lab.syphilis" tag="rpr-syphilis"/>
                    <render concept="CIEL:1322"   message="pihcore.lab.hepB" tag="hep-b"/>
                    <render concept="CIEL:159430" message="pihcore.lab.hepBSurface" tag="hep-b-ag"/>
                    <render concept="CIEL:161472" message="pihcore.lab.hepBSurfaceSpot" tag="hep-b-ag-spot"/>
                    <render concept="CIEL:1325"   message="pihcore.lab.hepC" tag="hep-c"/>
                    <render concept="CIEL:306"    message="pihcore.lab.typhoid" tag="widal"/>
                    <render concept="CIEL:163620" message="H. Pylori" tag="h-pylori"/>
                    <render concept="CIEL:161469" message="ASO" tag="aso-titer"/>
                    <render concept="CIEL:160913" message="pihcore.lab.psaQuant" tag="psa-quant"/>
                    <render concept="PIH:13448"   message="pihcore.lab.psaQual" tag="psa-qual"/>
                </repeat>
            </p>
        </fieldset>

        <fieldset class="multi-line-confirmation">
            <legend>
                <uimessage code="pihcore.lab.parasitology.title"/>
            </legend>
            <h3>
                <uimessage code="pihcore.lab.parasitology.title"/>
            </h3>
            <p>
                <label for="malarial-rdt">
                    <uimessage code="pihcore.lab.malariaRDT"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="malarial-rdt" conceptId="CIEL:1643"
                             placeholder="Enter value"/>
                    </field>
                </span>

                <label for="malarial-smear">
                    <uimessage code="pihcore.lab.malarial_smear"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="malarial-smear" conceptId="CIEL:32"
                             placeholder="Enter value"/>
                    </field>
                </span>

                <label for="zika-pcr">
                    <uimessage code="pihcore.lab.zika_pcr"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="zika-pcr" conceptId="CIEL:164920"
                             answerConceptIds="PIH:POSITIVE,PIH:NEGATIVE,PIH:INDETERMINATE" />
                    </field>
                </span>
                <label for="chik-pcr">
                    <uimessage code="pihcore.lab.chik_pcr"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="chik-pcr" conceptId="CIEL:164924"
                             answerConceptIds="PIH:POSITIVE,PIH:NEGATIVE,PIH:INDETERMINATE" />
                    </field>
                </span>
                <label for="dengue-pcr">
                    <uimessage code="pihcore.lab.dengue_pcr"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="dengue-pcr" conceptId="CIEL:164926"
                             answerConceptIds="PIH:POSITIVE,PIH:NEGATIVE,PIH:INDETERMINATE" />
                    </field>
                </span>

                <label for="zika-igg">
                    <uimessage code="pihcore.lab.zika_igg"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="zika-igg" conceptId="CIEL:164934"
                             answerConceptIds="CIEL:164931,CIEL:164932,CIEL:164933,PIH:NEGATIVE" />
                    </field>
                </span>
                <label for="zika-igm">
                    <uimessage code="pihcore.lab.zika_igm"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="zika-igm" conceptId="CIEL:164930"
                             answerConceptIds="CIEL:164931,CIEL:164932,CIEL:164933,PIH:NEGATIVE" />
                    </field>
                </span>

                <label for="filaria">
                    <uimessage code="pihcore.lab.filaria"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="filaria" conceptId="CIEL:165539" />
                    </field>
                </span>
            </p>

            <h4>
                <uimessage code="pihcore.lab.stool.exam"/>
            </h4>
            <repeat>
                <template>
                    <p>
                        <label for="stool-{message}">
                            <uimessage code="pihcore.lab.stool.{message}"/>
                        </label>
                        <span class="small">
                            <field>
                                <obs id="stool-{message}" conceptId="CIEL:{concept}" />
                            </field>
                        </span>
                    </p>
                </template>
                <render concept="304"    message="exam" />
                <render concept="163641" message="color" />
                <render concept="163640" message="appear" />
                <render concept="159362" message="occult" />
                <render concept="163634" message="leukocytes" />
            </repeat>
        </fieldset>

        <fieldset class="multi-line-confirmation">
            <legend>
                <uimessage code="pihcore.lab.urine"/>
            </legend>
            <h3>
                <uimessage code="pihcore.lab.urine"/>
            </h3>

            <repeat>
                <template>
                    <p>
                        <label for="urine-{message}">
                            <uimessage code="pihcore.lab.urine.{message}"/>
                        </label>
                        <span class="small">
                            <field>
                                <obs id="urine-{message}" conceptId="CIEL:{concept}" />
                            </field>
                        </span>
                    </p>
                </template>
                <render concept="163684" message="leuko" />
                <render concept="163683" message="eryth" />
                <render concept="163685" message="epi" />
                <render concept="160735" message="bact" />
                <render concept="163686" message="yeast" />
                <render concept="163688" message="spore" />
                <render concept="163689" message="tricho" />
                <render concept="163695" message="crystal" />

                <render concept="165540" message="hyalineCasts" />
                <render concept="163690" message="granularCasts" />
                <render concept="163693" message="leukocyteCasts" />
                <render concept="165541" message="erythrocyteCasts" />
                <render concept="165542" message="renalEpiCasts" />
                <render concept="163692" message="epiCasts" />
                <render concept="163691" message="fattyCasts" />
                <render concept="163694" message="waxyCasts" />

                <render concept="162106" message="color" />
                <render concept="162101" message="aspect" />
                <render concept="161439" message="density" />
                <render concept="161440" message="nitrite" />
                <render concept="163681" message="ascorbic" />
                <render concept="161438" message="pH" />
                <render concept="1875"   message="protein" />
                <render concept="159733" message="glucose" />
                <render concept="163682" message="urobili" />
                <render concept="163680" message="bili" />
                <render concept="162096" message="blood" />
                <render concept="45"     message="pregnancy" />
            </repeat>
        </fieldset>

        <fieldset class="multi-line-confirmation">
            <legend>
                <uimessage code="pihcore.lab.microbiology.title"/> (TB)
            </legend>

            <h3>
                <uimessage code="pihcore.lab.microbiology.title"/>
            </h3>

            <h4>
                TB
            </h4>

            <p>
                <label for="tb-smear-test">
                    <uimessage code="pihcore.lab.tbSmear"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="tb-smear-test" conceptId="CIEL:307" />
                    </field>
                </span>

                <label for="tb-culture-test">
                    <uimessage code="pihcore.lab.tbCulture"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="tb-culture-test" conceptId="CIEL:159982" />
                    </field>
                </span>

                <label for="tb-skin-test">
                    <uimessage code="pihcore.lab.tbSkin"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="tb-skin-test-qual" conceptId="PIH:1435" style="radio"
                             answerConceptIds="CIEL:703,CIEL:664,CIEL:1138" />
                    </field>
                </span>
                <div class="small">
                    <field>
                        <obs id="tb-skin-test-quant" conceptId="CIEL:5475"
                             showUnits="true"/>
                     </field>
                </div>

                <label for="tb-xpert">
                    <uimessage code="pihcore.lab.genexpert"/>
                </label>
                <span class="small">
                    <field>
                        <obs id="tb-xpert" conceptId="CIEL:162202" />
                    </field>
                </span>
            </p>

            <h4>Wet mount</h4>
            <p>
                <repeat>
                    <template>
                        <p>
                            <label for="micro-{message}">
                                <uimessage code="pihcore.lab.{message}"/>
                            </label>
                            <span class="small">
                                <field>
                                    <obs id="micro-{message}" conceptId="CIEL:{concept}" />
                                </field>
                            </span>
                        </p>
                    </template>
                    <render concept="163648" message="urine.tricho" />
                    <render concept="163650" message="urine.epi" />
                    <render concept="163605" message="urine.leuko" />
                    <render concept="163646" message="urine.yeast" />
                    <render concept="163649" message="hyphae" />
                    <render concept="163645" message="urine.bact" />
                    <render concept="161454" message="gramStain" />
                </repeat>
            </p>

        </fieldset>

    </section>

    <!-- To Do: What to do about retrospective entry?  Check the who? when? where? -->
    <div class="hidden" id="encounter-details" sectionTag="section" headerStyle="title" headerLabel="Encounter Details">
        <!-- See above for specimen collection date
        <fieldset>
            <legend>When?</legend>
            <label>When?</label>

            <encounterDate default="now" showTime="false"/>
        </fieldset>
        -->

        <fieldset>
            <legend>Who?</legend>
            <label>Who?</label>

            <encounterProviderAndRole default="currentUser" encounterRole="4f10ad1a-ec49-48df-98c7-1391c6ac7f05"
                                      required="true"/>
        </fieldset>


    </div>


    <submit/>

</htmlform>
